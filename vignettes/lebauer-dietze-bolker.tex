% !TeX root = RJwrapper.tex
\title{Translating Probability Distributions:\\ From R to BUGS and Back Again}
\author{by David S. LeBauer, Michael C. Dietze, Ben M. Bolker}

\maketitle

\abstract{
The ability to implement statistical models in the BUGS language facilitates Bayesian inference by automating MCMC algorithms.
Software written in the BUGS language include OpenBUGS, WinBUGS, and JAGS.
A suite of R packages integrate this software seamlessly into the R environemnt for use pre-processing data and analyzing model output.

However, the R and BUGS languages use different representations of common probability distributions,  creating a potential for errors to occur in the implementation or interpretation of analyses that use both languages.
Here we review different parameterizations used by the R and BUGS languages, describe how to translate between the languages, and provide an R function, \code{r2bugs.distributions}, that transforms parameterizations from R to BUGS, and back again.
}



First, we summarize distributions for which the default parameterizations used by R and BUGS are different (Table~\ref{tab:parameterizations}).

\begin{widetable}[h]
%\begin{center}
{\small
\begin{tabular}{llllll}
\toprule
Distribution       &  Language  &  Parameterization  &  Use &  Notes \\
\midrule
Normal&&&&\\
&  R      &  $\frac{1}{\sqrt{2 \pi}\sigma}\exp(-\frac{(x - \mu)^2}{2 \sigma^2})$ & \code{dnorm(x, mean = $\mu$, sd = $\sigma$)}& \\
&  BUGS   &  $\sqrt{\frac{\tau}{2\pi}}\exp(-(x-\mu)^2\tau)$ & \code{dnorm(mean = $\mu$, precision = $\tau$)} & $\tau=1/\sigma^2$  \\
log-Normal&&&&\\
&  R      &  $\frac{1}{\sqrt{2 \pi} \sigma x} \exp(-\frac{(\textrm{log}(x) - \mu)^2}{(2 \sigma^2)})$  &  \code{dlnorm(x, mean = $\mu$, sd = $\sigma$)}  & \\
&  BUGS   &  $\frac{\sqrt{\tau}}{x}\exp(\frac{-\tau(\textrm{log}(x)-\mu)^2}{2})$                     &  \code{dlnorm(mean = $\mu$, precision = $\tau$)} & $\tau=1/\sigma^2$\\
Binomial&&&&\\
&  R      &  ${n \choose x} p^{x}(1-p)^{n-x}$                                               &  \code{dbinom(x, size = $n$, prob = $p$)}  &  \\
&  BUGS   &  same   &  \code{dbin(prob = $p$, size = $n$)} & reverse parameter order \\
%
Negative Binomial&&&&reverse parameter order\\
&  R      &  $\frac{\Gamma(x+n)}{\Gamma(n) x!} p^n (1-p)^x$ &  \code{dnbinom(x, size = $n$, prob = $p$)} & size (\code{n}) is continuous    &     \\
%&  R$^*$      &  $\frac{\Gamma(k+x)}{\Gamma(k)x!}(\frac{k}{k+\mu})^k \frac{\mu}{(k+\mu)^x}$     &  \code{dnbinom(x, size = $n$, mu = $\mu$)} & \\%$\mu=n(1-p)/p$  \\
&  BUGS   &  ${x+r-1 \choose x}p^r(1-p)^x$ &  \code{dnegbin(prob = $p$, size = $r$)}     & size (\code{r}) is discrete  \\ 
Weibull&&&&\\
&  R      &  $\frac{a}{b} (\frac{x}{b})^{a-1} \exp(- (\frac{x}{b})^a)$                      &  \code{dweibull(x, shape = a, scale = b)}          & \\
&  BUGS   &  $\nu\lambda x^{\nu - 1}\exp(-\lambda x^{\nu})$  &  \code{dweib(shape = $\nu$, lambda = $\lambda$)}   & $\lambda=(1/b)^a$  \\
%%
Gamma&&&&reverse parameter order \\
&  R      &  ${\frac{r^a}{\Gamma(a)}} x^{a-1} \exp(-xr)$                                    &  \code{dgamma(x, shape = $$a, rate = $r$)} & \\
%&  R$^*$      &  ${\frac{1}{s^{a}\Gamma(a)}} x^{a-1} \exp(-x/s)$                                &  \code{dgamma(x, shape = a, scale = s)} &  \\
&  BUGS   &  ${\frac{\lambda^r x^{r-1}\exp(-\lambda x)}{\Gamma(r)}}$                        &  \code{dgamma(shape = $r$, lambda = $\lambda$)}  &  \\
\bottomrule
\end{tabular}
}
%\end{center}
\caption{\small{ Summary of different parameterizations of common distributions used by R and BUGS. The random variable $x$ is implicit in all of the BUGS ``Use'' parameterizations. For clarity and ease of reference, parameterizations follow the JAGS and R documentation. 
As a result, the table includes equations that appear different but are equivalent, either because the two equations use different names for the same variable or because the equation has been rearranged; for example the BUGS documentation of the \emph{Gamma} distribution uses $r$, while R uses $a$. 
In some cases, distributions use distinct density functions that require a related but distinct parameter; for example the Normal and log-Normal distributions use standard deviation ($\sigma$) in R and precision ($\tau$) in BUGS. 
In these cases, transformations are provided in the table. 
For the \emph{Binomial} and \emph{Negative Binomial} distributions, BUGS and R expect parameters in different order, and the order of parameters matters, since argument names are not used in BUGS and are optional in R.
The motivation for this article is to document and clarify these differences. 
This table only includes R's default parameterizations; the \emph{Negative Binomial} and \emph{Gamma} distributions have alternative parameterizations if the arguments are named. The \emph{Beta}, \emph{Poisson}, \emph{Exponential}, and \emph{Uniform} distributions have identical parameterizations in both BUGS and R.}}
\label{tab:parameterizations}
\end{widetable}


Although both R and BUGS document the computation and use of these probability distribution functions, we were unable to find a review of differences or a list of transformations between these languages are documented.

To support the automation of model specification in JAGS with priors computed and stored in R \citep{lebauer2012ffb}, we developed a function to translate parameterizations of common probability distributions from the R to the BUGS implementations.
Parameter transformations, parameter order, and differences in function names are documented in Table~\ref{tab:parameterizations} and implemented in the R function \code{r2bugs.distributions}. 
We developed this function to translate the parameterization of common probability distributions from R to BUGS (and back again, by specifying \code{direction = 'bugs2r'}.

\newpage
\begin{example}
r2bugs.distributions <- function(priors, direction = 'r2bugs') {
  priors$distn  <- as.character(priors$distn)
  priors$parama <- as.numeric(priors$parama)
  priors$paramb <- as.numeric(priors$paramb)
  ## index dataframe according to distribution
  norm   <- priors$distn %in% c('norm', 'lnorm')    # these have same tramsform
  weib   <- grepl("weib", priors$distn)             # matches r and bugs version
  gamma  <- priors$distn == 'gamma'
  chsq   <- grepl("chisq", priors$distn)            # matches r and bugs version
  bin    <- priors$distn %in% c('binom', 'bin')     # matches r and bugs version
  nbin   <- priors$distn %in% c('nbinom', 'negbin') # matches r and bugs version
  
  ## Normal, log-Normal: Convert sd to precision
  exponent <- ifelse(direction == "r2bugs", -2, -0.5) 
  priors$paramb[norm] <-  priors$paramb[norm] ^ exponent
  
  ## Weibull
  if(direction == 'r2bugs'){
    ## Convert R parameter b to BUGS parameter lambda by l = (1/b)^a
    priors$paramb[weib] <-   (1 / priors$paramb[weib]) ^ priors$parama[weib]
  } else if (direction == 'bugs2r') {
    ## Convert BUGS parameter lambda to BUGS parameter b by b = l^(-1/a)
    priors$paramb[weib] <-  priors$paramb[weib] ^ (- 1 / priors$parama[weib] ) 
  }
  
  ## Reverse parameter order for binomial and negative binomial
  priors[bin | nbin, c('parama', 'paramb')] <-  priors[bin | nbin, c('paramb', 'parama')]
  
  ## Translate distribution names
  if(direction == "r2bugs"){
    priors$distn[weib] <- "weib"
    priors$distn[chsq] <- "chisqr"
    priors$distn[bin]  <- "bin"
    priors$distn[nbin] <- "negbin"
  } else if(direction == "bugs2r"){
    priors$distn[weib] <- "weibull"
    priors$distn[chsq] <- "chisq"
    priors$distn[bin]  <- "binom"
    priors$distn[nbin] <- "nbinom"
  }
  return(priors)
}
\end{example}


As an example, below we state a prior distribution in R $X \sim \mathcal{N}(\mu=10,\sigma=2)$ , convert it to BUGS  $X \sim \mathcal{N}(\mu=10,\tau=1/4)$, and specify a model in JAGS that allows us to sample directly from the prior. 
The function works for each of the distributions in Table~\ref{tab:parameterizations}. 
This particular example is the JAGS implementation of \code{rnorm(10000, 10, 2)} in R; it is presented as minimal demonstration - for a non-trivial application, see \cite{lebauer2012ffb}. 

\begin{example}

r.distn <- data.frame(distn = "norm", parama = 10, paramb = 2)
bugs.distn <- r2bugs.distributions(r.distn)
   
sample.bugs.distn <- function(prior = data.frame(distn = "norm", parama = 0, paramb = 1), n = 10000) {
  require(rjags)
  model.string <- paste0("model{Y ~ d", prior$distn, "(", prior$parama, 
                         ifelse(prior$distn == "chisqr", "", paste0(", ", prior$paramb)), ## chisqr has one param
                         "); a <- x}")  ## tricks JAGS into running without data  
  writeLines(model.string, con = "test.bug")
  j.model  <- jags.model(file = "test.bug", data = list(x = 1))
  mcmc.object <- window(coda.samples(model = j.model, variable.names = c('Y'), n.iter = n * 4, thin = 2),
                        start = n)
  Y <- sample(as.matrix(mcmc.object)[,"Y"], n)
}
X <- sample.bugs.distn(bugs.distn)
\end{example}

\section{Acknowlegements}

This collaboration began on the statistical question and answer website Cross Validated (http://stats.stackexchange.com/q/5543/1381). Funding was provided to DSL and MCD by the Energy Biosciences Institute.

\bibliography{lebauer}


\address{David S. LeBauer\\
Energy Biosciences Institute\\
University of Illinois
USA}\\
\email{dlebauer@illinois.edu}

\address{Michael C. Dietze\\
Department of Earth And Environment\\
Boston University\\
USA}
\email{dietze@bu.edu}

\address{Ben M. Bolker\\
Department of Mathematics and Statistics\\
McMaster University\\
Canada}
\email{bolker@mcmaster.ca}
